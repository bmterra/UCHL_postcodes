<!DOCTYPE html>
<html>
    <head>
    <title>Postal Code Mapper</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>


    function callAPI(data) {
        var target = document.getElementById('results');
        target.innerHTML = '';

        $.ajax({
            async: true,
            type: "POST",
            url: "/pc_code",
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response,status) {
                var node = document.createTextNode(JSON.stringify(response));
                var para = document.createElement("p");
                para.appendChild(node);
                target.appendChild(para);
            },
            error: function (response,status) {
                alert("Error: "+status+' - '+JSON.stringify(response));
            },
            async: true
        });
    }

    function action() {
        var tmp = (document.getElementById('postal_codes').value);
        var postalCodes = tmp.split("\n");
        postalCodes.forEach(function(item) {
            if(item.length > 0) {
                callAPI({ 'postal_code': item})
            };
        });
    };

    </script>
    </head>
    <body>
        <textarea id="postal_codes" class="controls" type="text" name="Text1" cols="50" rows="20"></textarea>
        <button onclick="action()" id="sendb" name="sendb">Send</button>
        <div id="results"></div>
</body>
</html>
