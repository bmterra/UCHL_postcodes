<!DOCTYPE html>
<html>
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115862089-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-115862089-1');
        </script>

    <title>Place Autocomplete With Latitude & Longitude </title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
#pac-input {
    background-color: #fff;
    padding: 0 11px 0 13px;
    width: 400px;
    font-family: Roboto;
    font-size: 15px;
    font-weight: 300;
    text-overflow: ellipsis;
}
#pac-input:focus {
    border-color: #4d90fe;
    margin-left: -1px;
    padding-left: 14px;  /* Regular padding-left + 1. */
    width: 401px;
}
}
</style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCiTTnFGSuXdlTcACgx5eGm9VLroAqvHds&v=3.exp&libraries=places"></script>
    <script>

    function callAPI(data) {
      var opts = {
        method: 'POST',
        body: JSON.stringify(data),
        headers: {}
      };
      fetch('/pc_coord', opts).then(function (response) {
        return response.json();
      })
      .then(function (body) {
        console.log(JSON.stringify(body));
        var json = body;

        if (json['response']) {
            var clinics = json['clinics'];
            var myList = document.createElement('ul');
            document.getElementById('location').innerHTML = '';

            for (var j = 0; j < clinics.length; j++) {
                var listItem = document.createElement('li');
                listItem.textContent = clinics[j]['name']+' ('+parseFloat(Math.round(clinics[j]['distance'] * 100) / 100).toFixed(2)+'m)';
                myList.appendChild(listItem);
            }
            document.getElementById('location').appendChild(myList);
        } else {
            document.getElementById('location').innerHTML = "No result.";
        }

      });
    }

  function initialize() {
        var address = (document.getElementById('pac-input'));
        var options = {
        };

        var autocomplete = new google.maps.places.Autocomplete(address, options);
        autocomplete.setTypes(['geocode']);
        google.maps.event.addListener(autocomplete, 'place_changed', function() {
            var place = autocomplete.getPlace();
            if (!place.geometry) {
                return;
            }

        // Do call to service
        callAPI({
          address: place.formatted_address,
          lat: place.geometry.location.lat(),
          lon: place.geometry.location.lng()})
        });
  }

   google.maps.event.addDomListener(window, 'load', initialize);

    </script>
    </head>
    <body>
<input id="pac-input" class="controls" type="text"
        placeholder="Enter a location">
<div id="lat"></div>
<div id="long"></div>
<div id="location"></div>
</body>
</html>
